<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mock Test Generator</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0/dist/chartjs-plugin-datalabels.min.js"></script>
</head>
<body style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; background: #F8FAFC; color: #1F2937; line-height: 1.5; font-size: 14px; margin: 0; padding: 0;">
    <header style="background: #FFF; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 12px 0; margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; padding: 0 15px;">
            <div style="font-size: 20px; font-weight: 600; color: #4F46E5;">Mock Test Generator</div>
            <div>
                <button id="uploadMockBtn" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #4F46E5; color: white;">
                    <i class="fas fa-plus"></i> Upload Mock
                </button>
                <button id="exportMocksBtn" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #10B981; color: white; margin-left: 8px;">
                    <i class="fas fa-download"></i> Export
                </button>
            </div>
        </div>
    </header>
    
    <div class="container" id="dashboardContainer" style="max-width: 1200px; margin: 0 auto; padding: 15px;">
        <div id="analyticsSection" style="background: #FFF; border-radius: 6px; padding: 15px; margin-bottom: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
            <h2 style="font-size: 16px; font-weight: 600; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #E5E7EB;">Analytics</h2>
            <div id="analyticsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px;">
                <div style="padding: 12px; border-radius: 5px; border: 1px solid #E5E7EB; text-align: center;">
                    <div id="totalMocks" style="font-size: 20px; font-weight: 600; margin-bottom: 4px;">0</div>
                    <div style="font-size: 12px; color: #6B7280;">Total Mocks</div>
                </div>
                <div style="padding: 12px; border-radius: 5px; border: 1px solid #E5E7EB; text-align: center;">
                    <div id="sscCglMocks" style="font-size: 20px; font-weight: 600; margin-bottom: 4px;">0</div>
                    <div style="font-size: 12px; color: #6B7280;">SSC CGL</div>
                </div>
                <div style="padding: 12px; border-radius: 5px; border: 1px solid #E5E7EB; text-align: center;">
                    <div id="sscChslMocks" style="font-size: 20px; font-weight: 600; margin-bottom: 4px;">0</div>
                    <div style="font-size: 12px; color: #6B7280;">SSC CHSL</div>
                </div>
                <div style="padding: 12px; border-radius: 5px; border: 1px solid #E5E7EB; text-align: center;">
                    <div id="sscMtsMocks" style="font-size: 20px; font-weight: 600; margin-bottom: 4px;">0</div>
                    <div style="font-size: 12px; color: #6B7280;">SSC MTS</div>
                </div>
                <div style="padding: 12px; border-radius: 5px; border: 1px solid #E5E7EB; text-align: center;">
                    <div id="rrbNtpcMocks" style="font-size: 20px; font-weight: 600; margin-bottom: 4px;">0</div>
                    <div style="font-size: 12px; color: #6B7280;">RRB NTPC</div>
                </div>
            </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 220px 1fr; gap: 15px;">
            <div style="background: #FFF; border-radius: 6px; padding: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); height: fit-content;">
                <h3 style="font-size: 15px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #E5E7EB;">Menu</h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 8px;"><a href="#" id="dashboardLink" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px; background: rgba(79, 70, 229, 0.1); color: #4F46E5;"><i class="fas fa-home" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> Dashboard</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" id="analysisLink" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px;"><i class="fas fa-chart-pie" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> Analysis</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" id="historyLink" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px;"><i class="fas fa-history" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> Test History</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" id="settingsLink" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px;"><i class="fas fa-cog" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> Settings</a></li>
                </ul>
                
                <h3 style="font-size: 15px; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid #E5E7EB; margin-top: 20px;">Categories</h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 8px;"><a href="#" data-category="ssc_cgl" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px;"><i class="fas fa-graduation-cap" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> SSC CGL</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" data-category="ssc_chsl" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px;"><i class="fas fa-atom" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> SSC CHSL</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" data-category="ssc_mts" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px;"><i class="fas fa-flask" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> SSC MTS</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" data-category="rrb_ntpc" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px;"><i class="fas fa-book-open" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> RRB NTPC</a></li>
                    <li style="margin-bottom: 8px;"><a href="#" data-category="other" style="display: block; padding: 6px 10px; border-radius: 5px; color: #1F2937; text-decoration: none; transition: all 0.2s; font-size: 13px;"><i class="fas fa-folder" style="margin-right: 6px; width: 18px; text-align: center; font-size: 12px;"></i> Other</a></li>
                </ul>
            </div>
            
            <div style="background: #FFF; border-radius: 6px; padding: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #E5E7EB; flex-wrap: wrap; gap: 10px;">
                    <h2 style="font-size: 16px; font-weight: 600;">Recent Mock Tests</h2>
                    <div style="position: relative; width: 250px; margin-right: 8px;">
                        <i class="fas fa-search" style="position: absolute; left: 8px; top: 50%; transform: translateY(-50%); color: #6B7280; font-size: 12px;"></i>
                        <input type="text" id="searchInput" placeholder="Search mocks..." style="width: 100%; padding: 6px 12px 6px 30px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px;">
                    </div>
                    <div style="width: 180px;">
                        <select id="categoryFilter" style="width: 100%; padding: 6px 10px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px;">
                            <option value="all">All Categories</option>
                            <option value="ssc_cgl">SSC CGL</option>
                            <option value="ssc_chsl">SSC CHSL</option>
                            <option value="ssc_mts">SSC MTS</option>
                            <option value="rrb_ntpc">RRB NTPC</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                </div>
                
                <div id="mockGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                    <div style="text-align: center; padding: 30px 15px; color: #6B7280;">
                        <i class="fas fa-file-import" style="font-size: 40px; margin-bottom: 12px; color: #E5E7EB;"></i>
                        <h3 style="font-size: 15px; margin-bottom: 8px; color: #1F2937;">No Mock Tests Found</h3>
                        <p>Upload your first mock test to get started</p>
                        <button id="emptyUploadBtn" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #4F46E5; color: white; margin-top: 12px;">
                            <i class="fas fa-plus"></i> Upload Mock
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- New Analysis Section -->
    <div class="container" id="analysisContainer" style="display: none; max-width: 1200px; margin: 0 auto; padding: 15px;">
        <div style="border-radius: 16px; padding: 24px; margin-bottom: 32px; background: rgba(234, 88, 12, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; animation: fadeIn 0.5s ease-in-out;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                <h2 style="font-size: 24px; font-weight: 600;">Analysis</h2>
                <button id="backFromAnalysis" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            <div style="overflow-x: auto;">
                <table id="testTable" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: rgba(255, 255, 255, 0.05);">
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Date & Test Name</th>
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Quantitative</th>
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Reasoning</th>
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">English</th>
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">General Awareness</th>
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Total</th>
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Percentage</th>
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Feedback</th>
                            <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="testTableBody"></tbody>
                </table>
            </div>
        </div>

        <div style="border-radius: 16px; padding: 24px; margin-bottom: 32px; background: rgba(234, 88, 12, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; animation: fadeIn 0.5s ease-in-out;">
            <h2 style="font-size: 24px; font-weight: 600; margin-bottom: 24px;">Score Graph Analysis</h2>
            <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 24px;">
                <button onclick="showGraph('total')" style="color: #fb923c; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show Total Score Graph">
                    <i class="fas fa-sigma" style="margin-right: 8px;"></i> Total
                    <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View total score trend</span>
                </button>
                <button onclick="showGraph('quant')" style="color: #fdba74; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show Quantitative Score Graph">
                    <i class="fas fa-calculator" style="margin-right: 8px;"></i> Quantitative
                    <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View Quantitative Aptitude trend</span>
                </button>
                <button onclick="showGraph('reasoning')" style="color: #fed7aa; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show Reasoning Score Graph">
                    <i class="fas fa-puzzle-piece" style="margin-right: 8px;"></i> Reasoning
                    <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View Reasoning trend</span>
                </button>
                <button onclick="showGraph('english')" style="color: #ffedd5; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show English Score Graph">
                    <i class="fas fa-book" style="margin-right: 8px;"></i> English
                    <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View English trend</span>
                </button>
                <button onclick="showGraph('ga')" style="color: #fff7ed; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show General Awareness Score Graph">
                    <i class="fas fa-globe" style="margin-right: 8px;"></i> General Awareness
                    <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View General Awareness trend</span>
                </button>
            </div>
            <div id="scoresGraphContainer" style="display: none; position: relative;">
                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">Scores for <span id="selectedGraphName"></span></h3>
                <div id="graphSpinner" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #ea580c; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
                <canvas id="scoresChart" style="width: 100%; height: 256px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; padding: 10px; animation: chartFadeIn 1s ease-in-out;" aria-label="Score Trend Graph"></canvas>
            </div>
        </div>

        <div id="detailedAnalysis" style="border-radius: 16px; padding: 24px; margin-bottom: 32px; display: none; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(0, 0, 0, 0.1); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; animation: fadeIn 0.5s ease-in-out;">
            <h2 style="font-size: 24px; font-weight: 600; margin-bottom: 24px; color: #000000;">Detailed Analysis for <span id="selectedDate" style="color: #000000;"></span> (<span id="selectedTestName" style="color: #000000;"></span>)</h2>
            <div style="display: flex; flex-direction: column; gap: 24px; margin-bottom: 24px;">
                <div style="width: 100%;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #000000;">Question Stats</h3>
                    <div style="display: flex; flex-wrap: wrap; gap: 16px;">
                        <div style="display: flex; align-items: center; background: rgba(255, 255, 255, 0.8); border-radius: 9999px; padding: 8px 16px; border: 1px solid rgba(229, 231, 235, 1);">
                            <span style="width: 32px; height: 32px; border-radius: 9999px; background: #ea580c; display: flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 8px;">🎯</span>
                            <p style="font-size: 14px; color: #000000;">Score: <span id="detailScore" style="font-weight: 500;"></span>/200</p>
                        </div>
                        <div style="display: flex; align-items: center; background: rgba(255, 255, 255, 0.8); border-radius: 9999px; padding: 8px 16px; border: 1px solid rgba(229, 231, 235, 1);">
                            <span style="width: 32px; height: 32px; border-radius: 9999px; background: #f97316; display: flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 8px;">📝</span>
                            <p style="font-size: 14px; color: #000000;">Attempted: <span id="detailAttempted" style="font-weight: 500;"></span>/100</p>
                        </div>
                        <div style="display: flex; align-items: center; background: rgba(255, 255, 255, 0.8); border-radius: 9999px; padding: 8px 16px; border: 1px solid rgba(229, 231, 235, 1);">
                            <span style="width: 32px; height: 32px; border-radius: 9999px; background: #fb923c; display: flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 8px;">✔️</span>
                            <p style="font-size: 14px; color: #000000;">Accuracy: <span id="detailAccuracy" style="font-weight: 500;"></span>%</p>
                        </div>
                        <div style="display: flex; align-items: center; background: rgba(255, 255, 255, 0.8); border-radius: 9999px; padding: 8px 16px; border: 1px solid rgba(229, 231, 235, 1);">
                            <span style="width: 32px; height: 32px; border-radius: 9999px; background: #fdba74; display: flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 8px;">📈</span>
                            <p style="font-size: 14px; color: #000000;">Percentage: <span id="detailPercentage" style="font-weight: 500;"></span>%</p>
                        </div>
                    </div>
                </div>
                <div style="width: 100%; position: relative;">
                    <div id="statsSpinner" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 4px solid rgba(0, 0, 0, 0.3); border-top: 4px solid #ea580c; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
                    <canvas id="statsChart" style="width: 100%; height: 256px; background: rgba(255, 255, 255, 0.8); border-radius: 10px; padding: 10px; border: 1px solid rgba(0, 0, 0, 0.1);" aria-label="Question Stats Bar Chart"></canvas>
                </div>
            </div>
            <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #000000;">Sectional Summary</h3>
            <div style="overflow-x: auto;">
                <table id="sectionalTable" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: rgba(0, 0, 0, 0.05);">
                            <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Section Name</th>
                            <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Score</th>
                            <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Cutoff Score</th>
                            <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Attempted</th>
                            <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Correct</th>
                            <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Incorrect</th>
                            <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Unattempted</th>
                        </tr>
                    </thead>
                    <tbody id="sectionalTableBody" style="color: #000000;"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Test History Section -->
    <div class="container" id="historyContainer" style="display: none; max-width: 1200px; margin: 0 auto; padding: 15px;">
        <div style="background: #FFF; border-radius: 6px; padding: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #E5E7EB;">
                <h2 style="font-size: 16px; font-weight: 600;">Test History</h2>
                <button id="backFromHistory" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            
            <div id="historyList">
                <div style="text-align: center; padding: 30px 15px; color: #6B7280;">
                    <i class="fas fa-history" style="font-size: 40px; margin-bottom: 12px; color: #E5E7EB;"></i>
                    <h3 style="font-size: 15px; margin-bottom: 8px; color: #1F2937;">No Test History Found</h3>
                    <p>Complete your first mock test to see history</p>
                </div>
            </div>
        </div>
    </div>
     
         <!-- Settings Section -->
    <div class="container" id="settingsContainer" style="display: none; max-width: 1200px; margin: 0 auto; padding: 15px;">
        <div style="background: #FFF; border-radius: 6px; padding: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #E5E7EB;">
                <h2 style="font-size: 16px; font-weight: 600;">Settings</h2>
                <button id="backFromSettings" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Theme</label>
                <select id="themeSelect" style="width: 100%; padding: 6px 10px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px;">
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="system">System Default</option>
                </select>
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Default Test Duration (minutes)</label>
                <input type="number" id="defaultDuration" style="width: 100%; padding: 6px 10px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px;" value="60" min="1">
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Auto-save Results</label>
                <select id="autoSaveSelect" style="width: 100%; padding: 6px 10px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px;">
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Export Data</label>
                <button id="exportDataBtn" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #10B981; color: white;">
                    <i class="fas fa-file-export"></i> Export All Data
                </button>
            </div>
            
            <div style="margin-bottom: 12px;">
                <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Reset Data</label>
                <button id="resetDataBtn" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #EF4444; color: white;">
                    <i class="fas fa-trash"></i> Reset All Data
                </button>
            </div>
        </div>
    </div>
    
    <!-- Analysis Section (New Version) -->
    <div class="container" id="analysisContainer" style="display: none; max-width: 1200px; margin: 0 auto; padding: 15px;">
        <div style="background: #FFF; border-radius: 6px; padding: 15px; margin-bottom: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #E5E7EB;">
                <h2 style="font-size: 16px; font-weight: 600;">Test Performance Analysis</h2>
                <button id="backFromAnalysis" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            
            <section id="graphSection" style="border-radius: 16px; padding: 24px; margin-bottom: 32px; background: rgba(234, 88, 12, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; animation: fadeIn 0.5s ease-in-out;">
                <h2 style="font-size: 24px; font-weight: 600; margin-bottom: 24px;">Score Graph Analysis</h2>
                <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-bottom: 24px;">
                    <button onclick="showGraph('total')" style="color: #fb923c; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show Total Score Graph">
                        <i class="fas fa-sigma" style="margin-right: 8px;"></i> Total
                        <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View total score trend</span>
                    </button>
                    <button onclick="showGraph('quant')" style="color: #fdba74; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show Quantitative Score Graph">
                        <i class="fas fa-calculator" style="margin-right: 8px;"></i> Quantitative
                        <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View Quantitative Aptitude trend</span>
                    </button>
                    <button onclick="showGraph('reasoning')" style="color: #fed7aa; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show Reasoning Score Graph">
                        <i class="fas fa-puzzle-piece" style="margin-right: 8px;"></i> Reasoning
                        <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View Reasoning trend</span>
                    </button>
                    <button onclick="showGraph('english')" style="color: #ffedd5; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show English Score Graph">
                        <i class="fas fa-book" style="margin-right: 8px;"></i> English
                        <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View English trend</span>
                    </button>
                    <button onclick="showGraph('ga')" style="color: #fff7ed; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Show General Awareness Score Graph">
                        <i class="fas fa-globe" style="margin-right: 8px;"></i> General Awareness
                        <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">View General Awareness trend</span>
                    </button>
                </div>
                <div id="scoresGraphContainer" style="display: none; position: relative;">
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">Scores for <span id="selectedGraphName"></span></h3>
                    <div id="graphSpinner" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 4px solid rgba(255, 255, 255, 0.3); border-top: 4px solid #ea580c; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
                    <canvas id="scoresChart" style="width: 100%; height: 256px; background: rgba(255, 255, 255, 0.03); border-radius: 10px; padding: 10px; animation: chartFadeIn 1s ease-in-out;" aria-label="Score Trend Graph"></canvas>
                </div>
            </section>

            <section id="analysisSection" style="border-radius: 16px; padding: 24px; margin-bottom: 32px; background: rgba(234, 88, 12, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; animation: fadeIn 0.5s ease-in-out;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="font-size: 24px; font-weight: 600;">Analysis</h2>
                    <div style="display: flex; gap: 12px;">
                        <button onclick="exportToCSV()" style="color: #fb923c; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Export Data to CSV">
                            <i class="fas fa-download" style="margin-right: 8px;"></i> Export
                            <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">Export data to CSV</span>
                        </button>
                        <button onclick="openResetModal()" style="color: #fb923c; font-weight: 500; padding: 8px 16px; border-radius: 8px; display: flex; align-items: center; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Reset All Data">
                            <i class="fas fa-trash-alt" style="margin-right: 8px;"></i> Reset
                            <span style="visibility: hidden; position: absolute; bottom: 125%; left: 50%; transform: translateX(-50%); background: #000000; color: #ffffff; text-align: center; border-radius: 4px; padding: 5px 10px; z-index: 1; opacity: 0; transition: opacity 0.3s;">Reset all test data</span>
                        </button>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table id="testTable" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(255, 255, 255, 0.05);">
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Date & Test Name</th>
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Quantitative</th>
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Reasoning</th>
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">English</th>
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">General Awareness</th>
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Total</th>
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Percentage</th>
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Feedback</th>
                                <th style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; font-size: 14px; font-weight: 600;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="testTableBody"></tbody>
                    </table>
                </div>
            </section>

            <section id="detailedAnalysis" style="border-radius: 16px; padding: 24px; margin-bottom: 32px; display: none; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border: 1px solid rgba(0, 0, 0, 0.1); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; animation: fadeIn 0.5s ease-in-out;">
                <h2 style="font-size: 24px; font-weight: 600; margin-bottom: 24px; color: #000000;">Detailed Analysis for <span id="selectedDate" style="color: #000000;"></span> (<span id="selectedTestName" style="color: #000000;"></span>)</h2>
                <div style="display: flex; flex-direction: column; gap: 24px; margin-bottom: 24px;" class="lg:flex-row">
                    <div style="width: 100%;" class="lg:w-1/3">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #000000;">Question Stats</h3>
                        <div style="display: flex; flex-wrap: wrap; gap: 16px;">
                            <div style="display: flex; align-items: center; background: rgba(255, 255, 255, 0.8); border-radius: 9999px; padding: 8px 16px; border: 1px solid rgba(229, 231, 235, 1);">
                                <span style="width: 32px; height: 32px; border-radius: 9999px; background: #ea580c; display: flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 8px;">🎯</span>
                                <p style="font-size: 14px; color: #000000;">Score: <span id="detailScore" style="font-weight: 500;"></span>/200</p>
                            </div>
                            <div style="display: flex; align-items: center; background: rgba(255, 255, 255, 0.8); border-radius: 9999px; padding: 8px 16px; border: 1px solid rgba(229, 231, 235, 1);">
                                <span style="width: 32px; height: 32px; border-radius: 9999px; background: #f97316; display: flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 8px;">📝</span>
                                <p style="font-size: 14px; color: #000000;">Attempted: <span id="detailAttempted" style="font-weight: 500;"></span>/100</p>
                            </div>
                            <div style="display: flex; align-items: center; background: rgba(255, 255, 255, 0.8); border-radius: 9999px; padding: 8px 16px; border: 1px solid rgba(229, 231, 235, 1);">
                                <span style="width: 32px; height: 32px; border-radius: 9999px; background: #fb923c; display: flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 8px;">✔️</span>
                                <p style="font-size: 14px; color: #000000;">Accuracy: <span id="detailAccuracy" style="font-weight: 500;"></span>%</p>
                            </div>
                            <div style="display: flex; align-items: center; background: rgba(255, 255, 255, 0.8); border-radius: 9999px; padding: 8px 16px; border: 1px solid rgba(229, 231, 235, 1);">
                                <span style="width: 32px; height: 32px; border-radius: 9999px; background: #fdba74; display: flex; align-items: center; justify-content: center; color: #ffffff; margin-right: 8px;">📈</span>
                                <p style="font-size: 14px; color: #000000;">Percentage: <span id="detailPercentage" style="font-weight: 500;"></span>%</p>
                            </div>
                        </div>
                    </div>
                    <div style="width: 100%; position: relative;" class="lg:w-2/3">
                        <div id="statsSpinner" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 4px solid rgba(0, 0, 0, 0.3); border-top: 4px solid #ea580c; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
                        <canvas id="statsChart" style="width: 100%; height: 256px; background: rgba(255, 255, 255, 0.8); border-radius: 10px; padding: 10px; border: 1px solid rgba(0, 0, 0, 0.1);" aria-label="Question Stats Bar Chart"></canvas>
                    </div>
                </div>
                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 16px; color: #000000;">Sectional Summary</h3>
                <div style="overflow-x: auto;">
                    <table id="sectionalTable" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(0, 0, 0, 0.05);">
                                <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Section Name</th>
                                <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Score</th>
                                <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Cutoff Score</th>
                                <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Attempted</th>
                                <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Correct</th>
                                <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Incorrect</th>
                                <th style="border: 1px solid rgba(0, 0, 0, 0.1); padding: 12px; font-size: 14px; font-weight: 600; color: #000000;">Unattempted</th>
                            </tr>
                        </thead>
                        <tbody id="sectionalTableBody" style="color: #000000;"></tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
    
    <!-- Test History Section -->
    <div class="container" id="historyContainer" style="display: none; max-width: 1200px; margin: 0 auto; padding: 15px;">
        <div style="background: #FFF; border-radius: 6px; padding: 15px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid #E5E7EB;">
                <h2 style="font-size: 16px; font-weight: 600;">Test History</h2>
                <button id="backFromHistory" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
            
            <div id="historyList">
                <div style="text-align: center; padding: 30px 15px; color: #6B7280;">
                    <i class="fas fa-history" style="font-size: 40px; margin-bottom: 12px; color: #E5E7EB;"></i>
                    <h3 style="font-size: 15px; margin-bottom: 8px; color: #1F2937;">No Test History Found</h3>
                    <p>Complete your first mock test to see history</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Upload Modal -->
    <div class="modal" id="uploadModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000;">
        <div style="background: #FFF; border-radius: 6px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
            <div style="padding: 12px 15px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="font-size: 15px; font-weight: 600;">Upload Mock Test</h3>
                <button id="closeUploadModal" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #6B7280;">×</button>
            </div>
            <div style="padding: 15px;">
                <div style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Mock Test Name</label>
                    <input type="text" id="mockName" style="width: 100%; padding: 6px 10px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px;" placeholder="Enter mock test name">
                </div>
                
                <div style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Category</label>
                    <select id="mockCategory" style="width: 100%; padding: 6px 10px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px;">
                        <option value="ssc_cgl">SSC CGL</option>
                        <option value="ssc_chsl">SSC CHSL</option>
                        <option value="ssc_mts">SSC MTS</option>
                        <option value="rrb_ntpc">RRB NTPC</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Test Duration (minutes)</label>
                    <input type="number" id="testDuration" style="width: 100%; padding: 6px 10px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px;" placeholder="Enter duration in minutes (e.g., 60)" value="60" min="1">
                </div>
                
                <div style="margin-bottom: 12px;">
                    <label style="display: block; margin-bottom: 4px; font-weight: 500; font-size: 13px;">Description</label>
                    <textarea id="mockDescription" style="width: 100%; padding: 6px 10px; border-radius: 5px; border: 1px solid #E5E7EB; font-size: 13px; min-height: 80px; resize: vertical;" placeholder="Enter description (optional)"></textarea>
                </div>
                
                <div id="fileDropZone" style="border: 2px dashed #E5E7EB; border-radius: 5px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s;">
                    <i class="fas fa-file-upload" style="font-size: 30px; color: #4F46E5; margin-bottom: 8px;"></i>
                    <p>Drag & drop your mock HTML file here or click to browse</p>
                    <input type="file" id="fileInput" accept=".html,.htm" style="display: none;">
                    <div style="height: 4px; background: #E5E7EB; border-radius: 2px; margin-top: 8px; overflow: hidden;">
                        <div id="uploadProgress" style="height: 100%; background: #4F46E5; width: 0; transition: width 0.3s;"></div>
                    </div>
                    <div id="uploadStatus" style="margin-top: 12px; font-size: 13px; color: #6B7280;"></div>
                </div>
            </div>
            <div style="padding: 12px 15px; border-top: 1px solid #E5E7EB; display: flex; justify-content: flex-end; gap: 8px;">
                <button id="cancelUpload" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">Cancel</button>
                <button id="submitUpload" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #4F46E5; color: white;" disabled>Upload</button>
            </div>
        </div>
    </div>
    
    <!-- Test Result Modal -->
    <div class="modal" id="resultModal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000;">
        <div style="background: #FFF; border-radius: 6px; width: 100%; max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div style="padding: 12px 15px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="font-size: 15px; font-weight: 600;">Test Results</h3>
                <button id="closeResultModal" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #6B7280;">×</button>
            </div>
            <div style="padding: 15px;">
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 24px; font-weight: 600; color: #4F46E5; margin-bottom: 10px;">85%</div>
                    <div style="font-size: 16px; margin-bottom: 15px;">Good job! You scored better than 75% of test takers.</div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 20px;">
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">34/40</div>
                            <div style="font-size: 12px; color: #6B7280;">Questions Correct</div>
                        </div>
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">85%</div>
                            <div style="font-size: 12px; color: #6B7280;">Accuracy</div>
                        </div>
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">45m</div>
                            <div style="font-size: 12px; color: #6B7280;">Time Taken</div>
                        </div>
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">#1</div>
                            <div style="font-size: 12px; color: #6B7280;">Rank</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #E5E7EB;">
                    <div style="display: flex; border-bottom: 1px solid #E5E7EB; margin-bottom: 15px;">
                        <div class="analysis-tab active" data-tab="resultPerformance" style="padding: 8px 15px; cursor: pointer; border-bottom: 2px solid #4F46E5; color: #4F46E5; font-weight: 500;">Performance</div>
                        <div class="analysis-tab" data-tab="resultAnswers" style="padding: 8px 15px; cursor: pointer; border-bottom: 2px solid transparent;">Answers</div>
                        <div class="analysis-tab" data-tab="resultSolutions" style="padding: 8px 15px; cursor: pointer; border-bottom: 2px solid transparent;">Solutions</div>
                    </div>
                    
                    <div class="analysis-content active" id="resultPerformanceTab" style="display: block;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">85%</div>
                                <div style="font-size: 12px; color: #6B7280;">Overall Score</div>
                            </div>
                            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">92%</div>
                                <div style="font-size: 12px; color: #6B7280;">Quantitative</div>
                            </div>
                            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">78%</div>
                                <div style="font-size: 12px; color: #6B7280;">Reasoning</div>
                            </div>
                            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">80%</div>
                                <div style="font-size: 12px; color: #6B7280;">General Awareness</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <h4>Topic-wise Performance</h4>
                            <div style="margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="font-weight: 500;">Number System</span>
                                    <span>95%</span>
                                </div>
                                <div style="height: 8px; background: #E5E7EB; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; background: #4F46E5; width: 95%"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="font-weight: 500;">Algebra</span>
                                    <span>88%</span>
                                </div>
                                <div style="height: 8px; background: #E5E7EB; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; background: #4F46E5; width: 88%"></div>
                                </div>
                            </div>
                            <div style="margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                    <span style="font-weight: 500;">Geometry</span>
                                    <span>85%</span>
                                </div>
                                <div style="height: 8px; background: #E5E7EB; border-radius: 4px; overflow: hidden;">
                                    <div style="height: 100%; background: #4F46E5; width: 85%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analysis-content" id="resultAnswersTab" style="display: none;">
                        <h4>Your Answers</h4>
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; margin-bottom: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="margin-bottom: 8px; font-weight: 500;">1. What is the square root of 144?</div>
                            <div style="display: flex; gap: 15px; font-size: 12px;">
                                <span style="color: #10B981;"><i class="fas fa-check"></i> Your answer: 12 (Correct)</span>
                                <span style="color: #3B82F6;"><i class="fas fa-clock"></i> Time taken: 15s</span>
                            </div>
                        </div>
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; margin-bottom: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="margin-bottom: 8px; font-weight: 500;">2. Solve for x: 2x + 5 = 15</div>
                            <div style="display: flex; gap: 15px; font-size: 12px;">
                                <span style="color: #10B981;"><i class="fas fa-check"></i> Your answer: 5 (Correct)</span>
                                <span style="color: #3B82F6;"><i class="fas fa-clock"></i> Time taken: 22s</span>
                            </div>
                        </div>
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; margin-bottom: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="margin-bottom: 8px; font-weight: 500;">3. What is the capital of France?</div>
                            <div style="display: flex; gap: 15px; font-size: 12px;">
                                <span style="color: #EF4444;"><i class="fas fa-times"></i> Your answer: London (Incorrect)</span>
                                <span style="color: #3B82F6;"><i class="fas fa-clock"></i> Time taken: 8s</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="analysis-content" id="resultSolutionsTab" style="display: none;">
                        <h4>Solutions & Explanations</h4>
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; margin-bottom: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="margin-bottom: 8px; font-weight: 500;">1. What is the square root of 144?</div>
                            <div style="display: flex; gap: 15px; font-size: 12px;">
                                <span>Correct answer: 12</span>
                            </div>
                            <p style="margin-top: 8px; font-size: 13px;">
                                <strong>Explanation:</strong> The square root of a number is a value that, when multiplied by itself, gives the original number. 12 × 12 = 144.
                            </p>
                        </div>
                        <div style="background: #FFF; border-radius: 6px; padding: 12px; margin-bottom: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                            <div style="margin-bottom: 8px; font-weight: 500;">3. What is the capital of France?</div>
                            <div style="display: flex; gap: 15px; font-size: 12px;">
                                <span>Correct answer: Paris</span>
                            </div>
                            <p style="margin-top: 8px; font-size: 13px;">
                                <strong>Explanation:</strong> Paris has been the capital of France since the 5th century. It is the country's political and cultural center.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div style="padding: 12px 15px; border-top: 1px solid #E5E7EB; display: flex; justify-content: flex-end; gap: 8px;">
                <button id="saveResultBtn" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                    <i class="fas fa-save"></i> Save Results
                </button>
                <button id="reviewTestBtn" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #4F46E5; color: white;">
                    <i class="fas fa-redo"></i> Review Test
                </button>
            </div>
        </div>
    </div>
    
    <!-- Test Interface -->
    <div id="testInterface" style="display: none;">
        <div style="background: #FFF; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #E5E7EB;">
            <button id="backFromTest" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <div id="testTitle" style="font-size: 15px; font-weight: 600;">Mock Test</div>
            <div id="testTimer" style="font-weight: 600; color: #4F46E5;">60:00</div>
        </div>
        <div style="max-width: 100%; margin: 0; padding: 0; height: calc(100vh - 50px);">
            <iframe id="testIframe" style="width: 100%; height: calc(100vh - 100px); border: none;"></iframe>
        </div>
    </div>
    
    <!-- Feedback Modal -->
    <div id="feedbackModal" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center;" role="dialog" aria-labelledby="feedbackModalTitle">
        <div style="border-radius: 16px; padding: 24px; width: 100%; max-width: 448px; background: rgba(234, 88, 12, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1);">
            <h3 id="feedbackModalTitle" style="font-size: 20px; font-weight: 600; margin-bottom: 16px;">Feedback for <span id="feedbackTestName"></span></h3>
            <textarea id="feedbackInput" style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: #ffffff; resize: vertical;" rows="5" placeholder="Write your feedback here..." aria-label="Feedback Input"></textarea>
            <div style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 16px;">
                <button onclick="closeFeedbackModal()" style="color: #9ca3af; font-weight: 500; padding: 8px 16px; border-radius: 8px; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Cancel Feedback">Cancel</button>
                <button onclick="saveFeedback()" style="color: #fb923c; font-weight: 500; padding: 8px 16px; border-radius: 8px; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Save Feedback">Save</button>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div id="deleteModal" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center;" role="dialog" aria-labelledby="deleteModalTitle">
        <div style="border-radius: 16px; padding: 24px; width: 100%; max-width: 448px; background: rgba(234, 88, 12, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1);">
            <h3 id="deleteModalTitle" style="font-size: 20px; font-weight: 600; margin-bottom: 16px;">Confirm Deletion</h3>
            <p style="margin-bottom: 16px;">Are you sure you want to delete <span id="deleteTestName" style="font-weight: 500;"></span>?</p>
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="closeDeleteModal()" style="color: #9ca3af; font-weight: 500; padding: 8px 16px; border-radius: 8px; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Cancel Deletion">Cancel</button>
                <button onclick="confirmDelete()" style="color: #fb923c; font-weight: 500; padding: 8px 16px; border-radius: 8px; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Confirm Deletion">Delete</button>
            </div>
        </div>
    </div>

    <!-- Reset Modal -->
    <div id="resetModal" style="position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5); display: none; align-items: center; justify-content: center;" role="dialog" aria-labelledby="resetModalTitle">
        <div style="border-radius: 16px; padding: 24px; width: 100%; max-width: 448px; background: rgba(234, 88, 12, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1);">
            <h3 id="resetModalTitle" style="font-size: 20px; font-weight: 600; margin-bottom: 16px;">Confirm Reset</h3>
            <p style="margin-bottom: 16px;">Are you sure you want to reset all test data? This action cannot be undone.</p>
            <div style="display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="closeResetModal()" style="color: #9ca3af; font-weight: 500; padding: 8px 16px; border-radius: 8px; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Cancel Reset">Cancel</button>
                <button onclick="confirmReset()" style="color: #fb923c; font-weight: 500; padding: 8px 16px; border-radius: 8px; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Confirm Reset">Reset</button>
            </div>
        </div>
    </div>

    <script>
class MockTestGenerator {
    constructor() {
        this.mocks = [];
        this.testHistory = [];
        this.currentTest = null;
        this.timerInterval = null;
        this.timeRemaining = 0;
        this.statsChart = null;
        this.scoresChart = null;
        this.currentFeedbackIndex = null;
        this.currentDeleteIndex = null;
        this.currentGraphType = null;
        this.initElements();
        this.setupEventListeners();
        this.loadData();
        console.log('MockTestGenerator initialized');
    }

    initElements() {
        this.elements = {
            // Dashboard elements
            dashboardContainer: document.getElementById('dashboardContainer'),
            analysisContainer: document.getElementById('analysisContainer'),
            historyContainer: document.getElementById('historyContainer'),
            settingsContainer: document.getElementById('settingsContainer'),
            
            // Navigation links
            dashboardLink: document.getElementById('dashboardLink'),
            analysisLink: document.getElementById('analysisLink'),
            historyLink: document.getElementById('historyLink'),
            settingsLink: document.getElementById('settingsLink'),
            
            // Upload modal elements
            uploadModal: document.getElementById('uploadModal'),
            uploadMockBtn: document.getElementById('uploadMockBtn'),
            exportMocksBtn: document.getElementById('exportMocksBtn'),
            closeUploadModal: document.getElementById('closeUploadModal'),
            cancelUpload: document.getElementById('cancelUpload'),
            submitUpload: document.getElementById('submitUpload'),
            fileDropZone: document.getElementById('fileDropZone'),
            fileInput: document.getElementById('fileInput'),
            uploadProgress: document.getElementById('uploadProgress'),
            uploadStatus: document.getElementById('uploadStatus'),
            mockGrid: document.getElementById('mockGrid'),
            emptyUploadBtn: document.getElementById('emptyUploadBtn'),
            mockName: document.getElementById('mockName'),
            mockCategory: document.getElementById('mockCategory'),
            testDuration: document.getElementById('testDuration'),
            mockDescription: document.getElementById('mockDescription'),
            
            // Test interface elements
            testInterface: document.getElementById('testInterface'),
            testIframe: document.getElementById('testIframe'),
            testTitle: document.getElementById('testTitle'),
            testTimer: document.getElementById('testTimer'),
            backFromTest: document.getElementById('backFromTest'),
            
            // Search and filter
            searchInput: document.getElementById('searchInput'),
            categoryFilter: document.getElementById('categoryFilter'),
            
            // Analytics elements
            totalMocks: document.getElementById('totalMocks'),
            sscCglMocks: document.getElementById('sscCglMocks'),
            sscChslMocks: document.getElementById('sscChslMocks'),
            sscMtsMocks: document.getElementById('sscMtsMocks'),
            rrbNtpcMocks: document.getElementById('rrbNtpcMocks'),
            
            // Analysis elements
            totalTestsTaken: document.getElementById('totalTestsTaken'),
            avgScore: document.getElementById('avgScore'),
            bestScore: document.getElementById('bestScore'),
            avgTime: document.getElementById('avgTime'),
            scoresGraphContainer: document.getElementById('scoresGraphContainer'),
            selectedGraphName: document.getElementById('selectedGraphName'),
            graphSpinner: document.getElementById('graphSpinner'),
            statsSpinner: document.getElementById('statsSpinner'),
            detailedAnalysis: document.getElementById('detailedAnalysis'),
            selectedDate: document.getElementById('selectedDate'),
            selectedTestName: document.getElementById('selectedTestName'),
            detailScore: document.getElementById('detailScore'),
            detailAttempted: document.getElementById('detailAttempted'),
            detailAccuracy: document.getElementById('detailAccuracy'),
            detailPercentage: document.getElementById('detailPercentage'),
            sectionalTableBody: document.getElementById('sectionalTableBody'),
            testTableBody: document.getElementById('testTableBody'),
            
            // Result modal elements
            resultModal: document.getElementById('resultModal'),
            closeResultModal: document.getElementById('closeResultModal'),
            saveResultBtn: document.getElementById('saveResultBtn'),
            reviewTestBtn: document.getElementById('reviewTestBtn'),
            
            // Settings elements
            themeSelect: document.getElementById('themeSelect'),
            defaultDuration: document.getElementById('defaultDuration'),
            autoSaveSelect: document.getElementById('autoSaveSelect'),
            exportDataBtn: document.getElementById('exportDataBtn'),
            resetDataBtn: document.getElementById('resetDataBtn'),
            
            // Feedback modal elements
            feedbackModal: document.getElementById('feedbackModal'),
            feedbackTestName: document.getElementById('feedbackTestName'),
            feedbackInput: document.getElementById('feedbackInput'),
            
            // Delete modal elements
            deleteModal: document.getElementById('deleteModal'),
            deleteTestName: document.getElementById('deleteTestName'),
            
            // Reset modal elements
            resetModal: document.getElementById('resetModal'),
            
            // Back buttons
            backFromAnalysis: document.getElementById('backFromAnalysis'),
            backFromHistory: document.getElementById('backFromHistory'),
            backFromSettings: document.getElementById('backFromSettings')
        };

        this.graphInfo = {
            total: { name: 'Total', color: 'rgba(79, 70, 229, 0.3)', borderColor: '#4F46E5', max: 200, yAxisTitle: 'Total Score (out of 200)' },
            quant: { name: 'Quantitative Aptitude', color: 'rgba(16, 185, 129, 0.3)', borderColor: '#10B981', max: 50, yAxisTitle: 'Score (out of 50)' },
            reasoning: { name: 'Reasoning', color: 'rgba(245, 158, 11, 0.3)', borderColor: '#F59E0B', max: 50, yAxisTitle: 'Score (out of 50)' },
            english: { name: 'English', color: 'rgba(59, 130, 246, 0.3)', borderColor: '#3B82F6', max: 50, yAxisTitle: 'Score (out of 50)' },
            ga: { name: 'General Awareness', color: 'rgba(239, 68, 68, 0.3)', borderColor: '#EF4444', max: 50, yAxisTitle: 'Score (out of 50)' }
        };
    }

    setupEventListeners() {
        // Navigation
        this.elements.dashboardLink.addEventListener('click', (e) => {
            e.preventDefault();
            this.showDashboard();
        });
        
        this.elements.analysisLink.addEventListener('click', (e) => {
            e.preventDefault();
            this.showAnalysis();
        });
        
        this.elements.historyLink.addEventListener('click', (e) => {
            e.preventDefault();
            this.showHistory();
        });
        
        this.elements.settingsLink.addEventListener('click', (e) => {
            e.preventDefault();
            this.showSettings();
        });

        // Upload modal
        this.elements.uploadMockBtn.addEventListener('click', () => this.showUploadModal());
        this.elements.emptyUploadBtn?.addEventListener('click', () => this.showUploadModal());
        this.elements.closeUploadModal.addEventListener('click', () => this.hideUploadModal());
        this.elements.cancelUpload.addEventListener('click', () => this.hideUploadModal());
        
        // File handling
        this.elements.fileDropZone.addEventListener('click', () => this.elements.fileInput.click());
        this.elements.fileInput.addEventListener('change', (e) => this.handleFileSelection(e));
        this.elements.submitUpload.addEventListener('click', () => this.processUpload());
        
        // Drag and drop
        this.elements.fileDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            this.elements.fileDropZone.style.borderColor = '#4F46E5';
            this.elements.fileDropZone.style.background = 'rgba(79, 70, 229, 0.05)';
        });
        
        this.elements.fileDropZone.addEventListener('dragleave', () => {
            this.elements.fileDropZone.style.borderColor = '#E5E7EB';
            this.elements.fileDropZone.style.background = '';
        });
        
        this.elements.fileDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            this.elements.fileDropZone.style.borderColor = '#E5E7EB';
            this.elements.fileDropZone.style.background = '';
            if (e.dataTransfer.files.length > 0) {
                this.elements.fileInput.files = e.dataTransfer.files;
                this.handleFileSelection({ target: this.elements.fileInput });
            }
        });

        // Test interface
        this.elements.backFromTest.addEventListener('click', () => {
            if (confirm('Are you sure you want to leave the test? Your progress will be lost.')) {
                this.showDashboard();
            }
        });
        
        // Export mocks
        this.elements.exportMocksBtn.addEventListener('click', () => this.exportMocks());
        
        // Search and filter
        this.elements.searchInput.addEventListener('input', () => this.renderMocks());
        this.elements.categoryFilter.addEventListener('change', () => this.renderMocks());
        
        // Mock grid interactions
        this.elements.mockGrid.addEventListener('click', (e) => this.handleMockGridClick(e));
        
        // Sidebar category filter
        document.querySelectorAll('.sidebar-menu a[data-category]').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const category = e.currentTarget.getAttribute('data-category');
                this.elements.categoryFilter.value = category;
                this.renderMocks();
            });
        });
        
        // Result modal
        this.elements.closeResultModal.addEventListener('click', () => {
            this.elements.resultModal.style.display = 'none';
            this.showDashboard();
        });
        
        this.elements.saveResultBtn.addEventListener('click', () => {
            this.elements.resultModal.style.display = 'none';
            this.showDashboard();
        });
        
        this.elements.reviewTestBtn.addEventListener('click', () => {
            this.elements.resultModal.style.display = 'none';
            if (this.currentTest) {
                this.startMockTest(this.currentTest.id);
            }
        });
        
        // Settings
        this.elements.exportDataBtn.addEventListener('click', () => this.exportAllData());
        this.elements.resetDataBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                this.resetAllData();
            }
        });
        this.elements.themeSelect.addEventListener('change', () => this.applyTheme(this.elements.themeSelect.value));
        
        // Back buttons
        if (this.elements.backFromAnalysis) {
            this.elements.backFromAnalysis.addEventListener('click', () => this.showDashboard());
        }
        if (this.elements.backFromHistory) {
            this.elements.backFromHistory.addEventListener('click', () => this.showDashboard());
        }
        if (this.elements.backFromSettings) {
            this.elements.backFromSettings.addEventListener('click', () => this.showDashboard());
        }

        // Feedback modal
        this.elements.feedbackModal.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.closeFeedbackModal();
            }
        });

        // Delete modal
        this.elements.deleteModal.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.closeDeleteModal();
            }
        });

        // Reset modal
        this.elements.resetModal.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.closeResetModal();
            }
        });
    }

    loadData() {
        this.loadMocks();
        this.loadTestHistory();
        this.loadSettings();
        this.renderAnalytics();
        this.renderTestAnalysis();
    }

    loadMocks() {
        try {
            const savedMocks = localStorage.getItem('mockTests');
            if (savedMocks) {
                this.mocks = JSON.parse(savedMocks) || [];
                this.renderMocks();
            }
        } catch (e) {
            console.error('Error loading mocks:', e);
            this.mocks = [];
        }
    }

    loadTestHistory() {
        try {
            const savedHistory = localStorage.getItem('testHistory');
            if (savedHistory) {
                this.testHistory = JSON.parse(savedHistory) || [];
                this.renderTestHistory();
                this.renderTestTable();
            }
        } catch (e) {
            console.error('Error loading test history:', e);
            this.testHistory = [];
        }
    }

    loadSettings() {
        try {
            const savedSettings = localStorage.getItem('appSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                this.elements.themeSelect.value = settings.theme || 'light';
                this.elements.defaultDuration.value = settings.defaultDuration || 60;
                this.elements.autoSaveSelect.value = settings.autoSave || 'yes';
                this.applyTheme(settings.theme);
            }
        } catch (e) {
            console.error('Error loading settings:', e);
        }
    }

    saveSettings() {
        const settings = {
            theme: this.elements.themeSelect.value,
            defaultDuration: parseInt(this.elements.defaultDuration.value),
            autoSave: this.elements.autoSaveSelect.value
        };
        localStorage.setItem('appSettings', JSON.stringify(settings));
    }

    applyTheme(theme) {
        if (theme === 'dark') {
            document.body.style.setProperty('--bg', '#1F2937');
            document.body.style.setProperty('--card', '#374151');
            document.body.style.setProperty('--text', '#F9FAFB');
            document.body.style.setProperty('--text-light', '#9CA3AF');
            document.body.style.setProperty('--border', '#4B5563');
        } else if (theme === 'light') {
            document.body.style.setProperty('--bg', '#F8FAFC');
            document.body.style.setProperty('--card', '#FFF');
            document.body.style.setProperty('--text', '#1F2937');
            document.body.style.setProperty('--text-light', '#6B7280');
            document.body.style.setProperty('--border', '#E5E7EB');
        }
    }

    showUploadModal() {
        this.elements.uploadModal.style.display = 'flex';
        this.resetUploadForm();
    }

    hideUploadModal() {
        this.elements.uploadModal.style.display = 'none';
        this.resetUploadForm();
    }

    resetUploadForm() {
        this.elements.mockName.value = '';
        this.elements.mockCategory.value = 'ssc_cgl';
        this.elements.testDuration.value = this.elements.defaultDuration.value || '60';
        this.elements.mockDescription.value = '';
        this.elements.fileInput.value = '';
        this.elements.uploadProgress.style.width = '0';
        this.elements.uploadStatus.textContent = '';
        this.elements.uploadStatus.className = 'upload-status';
        this.elements.submitUpload.disabled = true;
    }

    handleFileSelection(e) {
        const files = e.target.files;
        if (!files || files.length === 0) {
            this.elements.uploadStatus.textContent = 'No file selected';
            this.elements.uploadStatus.className = 'upload-status upload-error';
            return;
        }
        this.elements.uploadStatus.textContent = `Selected: ${files[0].name}`;
        this.elements.uploadStatus.className = 'upload-status';
        this.elements.submitUpload.disabled = false;
    }

    processUpload() {
        const name = this.elements.mockName.value.trim();
        const category = this.elements.mockCategory.value;
        const duration = parseInt(this.elements.testDuration.value, 10);
        const description = this.elements.mockDescription.value.trim();
        const files = this.elements.fileInput.files;

        if (!name) {
            this.showUploadError('Please enter a mock test name');
            return;
        }

        if (isNaN(duration) || duration < 1) {
            this.showUploadError('Please enter a valid test duration (minimum 1 minute)');
            return;
        }

        if (!files || files.length !== 1) {
            this.showUploadError('Please select exactly one HTML file');
            return;
        }

        this.elements.submitUpload.disabled = true;
        this.elements.uploadStatus.innerHTML = '<span class="upload-processing"><i class="fas fa-spinner"></i> Processing file...</span>';

        const uploadTimeout = setTimeout(() => {
            this.showUploadError('Processing took too long. Please try a smaller file.');
            this.elements.uploadProgress.style.width = '0';
        }, 30000);

        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += 10;
            this.elements.uploadProgress.style.width = `${progress}%`;
            if (progress >= 100) {
                clearInterval(progressInterval);
                this.processFiles(name, category, duration, description, files)
                    .finally(() => clearTimeout(uploadTimeout));
            }
        }, 200);
    }

    async processFiles(name, category, duration, description, files) {
        const mockTest = {
            id: Date.now().toString(),
            name,
            category,
            duration,
            description,
            date: new Date().toISOString(),
            fileName: files[0].name,
            fileContent: '',
            status: 'Not Started'
        };

        try {
            const content = await this.readFile(files[0]);
            mockTest.fileContent = content;
            this.finishUpload(mockTest);
        } catch (err) {
            console.error(`Error processing ${files[0].name}:`, err);
            this.showUploadError(`Failed to process ${files[0].name}: ${err.message}`);
        }
    }

    readFile(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.onerror = (e) => reject(new Error('File read error'));
            reader.readAsText(file);
        });
    }

    finishUpload(mockTest) {
        this.mocks.unshift(mockTest);
        this.saveMocks();
        
        this.elements.uploadStatus.textContent = 'Upload completed successfully!';
        this.elements.uploadStatus.className = 'upload-status upload-success';
        
        setTimeout(() => {
            this.hideUploadModal();
            this.renderMocks();
            this.renderAnalytics();
        }, 1500);
    }

    showUploadError(message) {
        this.elements.uploadStatus.textContent = message;
        this.elements.uploadStatus.className = 'upload-status upload-error';
        this.elements.submitUpload.disabled = false;
        this.elements.uploadProgress.style.width = '0';
    }

    saveMocks() {
        try {
            localStorage.setItem('mockTests', JSON.stringify(this.mocks));
            this.renderMocks();
            this.renderAnalytics();
        } catch (e) {
            console.error('Error saving mocks:', e);
            alert('Failed to save mock tests. Please check browser storage settings.');
        }
    }

    saveTestHistory() {
        try {
            localStorage.setItem('testHistory', JSON.stringify(this.testHistory));
            this.renderTestHistory();
            this.renderTestAnalysis();
            this.renderTestTable();
        } catch (e) {
            console.error('Error saving test history:', e);
        }
    }

    renderMocks() {
        const grid = this.elements.mockGrid;
        const searchTerm = this.elements.searchInput.value.toLowerCase();
        const categoryFilter = this.elements.categoryFilter.value;

        const filteredMocks = this.mocks.filter(mock => {
            const matchesSearch = mock.name.toLowerCase().includes(searchTerm) || 
                                 (mock.description && mock.description.toLowerCase().includes(searchTerm));
            const matchesCategory = categoryFilter === 'all' || mock.category === categoryFilter;
            return matchesSearch && matchesCategory;
        });

        if (!filteredMocks.length) {
            grid.innerHTML = `
                <div style="text-align: center; padding: 30px 15px; color: #6B7280;">
                    <i class="fas fa-file-import" style="font-size: 40px; margin-bottom: 12px; color: #E5E7EB;"></i>
                    <h3 style="font-size: 15px; margin-bottom: 8px; color: #1F2937;">No Mock Tests Found</h3>
                    <p>Upload your first mock test to get started</p>
                    <button id="emptyUploadBtn" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #4F46E5; color: white; margin-top: 12px;">
                        <i class="fas fa-plus"></i> Upload Mock
                    </button>
                </div>
            `;
            document.getElementById('emptyUploadBtn')?.addEventListener('click', () => this.showUploadModal());
            return;
        }
        
        grid.innerHTML = '';

        filteredMocks.forEach(mock => {
            const categoryInfo = this.getCategoryInfo(mock.category);
            const date = new Date(mock.date);
            const formattedDate = date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
            
            const testHistory = this.testHistory.filter(t => t.testId === mock.id);
            const lastScore = testHistory.length > 0 ? `${testHistory[0].score}%` : 'N/A';
            
            const card = document.createElement('div');
            card.style.background = '#FFF';
            card.style.borderRadius = '6px';
            card.style.overflow = 'hidden';
            card.style.boxShadow = '0 1px 2px rgba(0,0,0,0.1)';
            card.style.transition = 'all 0.3s';
            card.style.border = '1px solid #E5E7EB';
            card.innerHTML = `
                <div style="background: ${categoryInfo.color}; color: white; padding: 12px;">
                    <h3 style="font-size: 15px; font-weight: 600; margin-bottom: 4px;">${mock.name}</h3>
                    <div style="font-size: 12px; opacity: 0.9;">
                        <span>${categoryInfo.name}</span>
                        <span> • ${formattedDate}</span>
                        <span> • Last score: ${lastScore}</span>
                    </div>
                </div>
                <div style="padding: 12px;">
                    <p>${mock.description || 'No description provided'}</p>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 12px; gap: 5px;">
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 15px; font-weight: 600;">1</div>
                            <div style="font-size: 11px; color: #6B7280;">File</div>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 15px; font-weight: 600;">${mock.duration}</div>
                            <div style="font-size: 11px; color: #6B7280;">Minutes</div>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 15px; font-weight: 600;">${testHistory.length}</div>
                            <div style="font-size: 11px; color: #6B7280;">Attempts</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 12px; border-top: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="btn btn-outline btn-view btn-sm" data-id="${mock.id}" style="display: inline-block; padding: 5px 10px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 12px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                            <i class="fas fa-eye"></i> View
                        </button>
                        <button class="btn btn-outline btn-preview btn-sm" data-id="${mock.id}" style="display: inline-block; padding: 5px 10px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 12px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                            <i class="fas fa-search"></i> Preview
                        </button>
                        <button class="btn btn-outline btn-history btn-sm" data-id="${mock.id}" style="display: inline-block; padding: 5px 10px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 12px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                            <i class="fas fa-history"></i> History
                        </button>
                        <button class="btn btn-danger btn-delete btn-sm" data-id="${mock.id}" style="display: inline-block; padding: 5px 10px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 12px; background: #EF4444; color: white;">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                    <button class="btn btn-primary btn-start btn-sm" data-id="${mock.id}" style="display: inline-block; padding: 5px 10px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 12px; background: #4F46E5; color: white;">
                        <i class="fas fa-play"></i> Start Test
                    </button>
                </div>
            `;
            
            grid.appendChild(card);
        });
    }

    renderTestHistory() {
        const historyList = document.getElementById('historyList');
        
        if (!this.testHistory.length) {
            historyList.innerHTML = `
                <div style="text-align: center; padding: 30px 15px; color: #6B7280;">
                    <i class="fas fa-history" style="font-size: 40px; margin-bottom: 12px; color: #E5E7EB;"></i>
                    <h3 style="font-size: 15px; margin-bottom: 8px; color: #1F2937;">No Test History Found</h3>
                    <p>Complete your first mock test to see history</p>
                </div>
            `;
            return;
        }
        
        historyList.innerHTML = '';
        
        this.testHistory.forEach(test => {
            const mock = this.mocks.find(m => m.id === test.testId) || { name: 'Unknown Test' };
            const date = new Date(test.date);
            const formattedDate = date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const historyItem = document.createElement('div');
            historyItem.style.background = '#FFF';
            historyItem.style.borderRadius = '6px';
            historyItem.style.overflow = 'hidden';
            historyItem.style.boxShadow = '0 1px 2px rgba(0,0,0,0.1)';
            historyItem.style.border = '1px solid #E5E7EB';
            historyItem.innerHTML = `
                <div style="background: ${this.getCategoryInfo(test.category).color}; color: white; padding: 12px;">
                    <h3 style="font-size: 15px; font-weight: 600; margin-bottom: 4px;">${mock.name}</h3>
                    <div style="font-size: 12px; opacity: 0.9;">
                        <span>${formattedDate}</span>
                        <span> • Score: ${test.score}%</span>
                    </div>
                </div>
                <div style="padding: 12px;">
                    <div style="display: flex; justify-content: space-between; gap: 5px;">
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 15px; font-weight: 600;">${test.correctAnswers}/${test.totalQuestions}</div>
                            <div style="font-size: 11px; color: #6B7280;">Correct Answers</div>
                        </div>
                        <div style="text-align: center; flex: 1;">
                            <div style="font-size: 15px; font-weight: 600;">${Math.floor(test.timeTaken / 60)}m ${test.timeTaken % 60}s</div>
                            <div style="font-size: 11px; color: #6B7280;">Time Taken</div>
                        </div>
                    </div>
                </div>
                <div style="padding: 12px; border-top: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;">
                    <button class="btn btn-outline btn-view-result btn-sm" data-id="${test.id}" style="display: inline-block; padding: 5px 10px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 12px; background: transparent; border: 1px solid #E5E7EB; color: #1F2937;">
                        <i class="fas fa-chart-bar"></i> View Result
                    </button>
                    <button class="btn btn-primary btn-retry btn-sm" data-id="${test.testId}" style="display: inline-block; padding: 5px 10px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 12px; background: #4F46E5; color: white;">
                        <i class="fas fa-redo"></i> Retry Test
                    </button>
                </div>
            `;
            
            historyList.appendChild(historyItem);
        });
        
        document.querySelectorAll('.btn-view-result').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = e.currentTarget.getAttribute('data-id');
                const result = this.testHistory.find(r => r.id === id);
                if (result) {
                    this.currentTest = this.mocks.find(m => m.id === result.testId) || null;
                    this.showTestResult(result);
                }
            });
        });
        
        document.querySelectorAll('.btn-retry').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const id = e.currentTarget.getAttribute('data-id');
                this.startMockTest(id);
            });
        });
    }

    renderTestTable() {
        this.elements.testTableBody.innerHTML = '';
        this.testHistory.forEach((test, index) => {
            const mock = this.mocks.find(m => m.id === test.testId) || { name: 'Unknown Test' };
            const row = document.createElement('tr');
            row.innerHTML = `
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px; cursor: pointer;" class="hover:underline" onclick="app.showDetailedAnalysis(${index})" tabindex="0" aria-label="View detailed analysis for ${test.date} ${mock.name}">${test.date} (${mock.name})</td>
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px;" title="Quantitative Score: ${test.quant.score}">${test.quant.score}</td>
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px;" title="Reasoning Score: ${test.reasoning.score}">${test.reasoning.score}</td>
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px;" title="English Score: ${test.english.score}">${test.english.score}</td>
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px;" title="General Awareness Score: ${test.ga.score}">${test.ga.score}</td>
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px;" title="Total Score: ${test.total}">${test.total}</td>
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px;" title="Percentage: ${test.percentage}%">${test.percentage}%</td>
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px;">
                    <button onclick="app.openFeedbackModal(${index})" style="color: #fb923c; font-weight: 500; padding: 4px 12px; border-radius: 8px; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="${test.feedback ? 'View/Edit' : 'Add'} Feedback for ${mock.name}">
                        <i class="fas fa-comment" style="margin-right: 4px;"></i> ${test.feedback ? 'View/Edit' : 'Add'}
                    </button>
                </td>
                <td style="border: 1px solid rgba(255, 255, 255, 0.1); padding: 12px;">
                    <button onclick="app.deleteTest(${index})" style="color: #fb923c; font-weight: 500; padding: 4px 12px; border-radius: 8px; background: #000000; box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.3), -5px -5px 15px rgba(255, 255, 255, 0.1); transition: all 0.3s ease; position: relative;" aria-label="Delete ${mock.name}">
                        <i class="fas fa-trash" style="margin-right: 4px;"></i> Delete
                    </button>
                </td>
            `;
            this.elements.testTableBody.appendChild(row);
        });
    }

    renderAnalytics() {
        this.elements.totalMocks.textContent = this.mocks.length;
        this.elements.sscCglMocks.textContent = this.mocks.filter(m => m.category === 'ssc_cgl').length;
        this.elements.sscChslMocks.textContent = this.mocks.filter(m => m.category === 'ssc_chsl').length;
        this.elements.sscMtsMocks.textContent = this.mocks.filter(m => m.category === 'ssc_mts').length;
        this.elements.rrbNtpcMocks.textContent = this.mocks.filter(m => m.category === 'rrb_ntpc').length;
    }

    renderTestAnalysis() {
        if (!this.testHistory.length) return;
        
        const totalTests = this.testHistory.length;
        const avgScore = Math.round(this.testHistory.reduce((sum, test) => sum + test.score, 0) / totalTests);
        const bestScore = Math.max(...this.testHistory.map(test => test.score));
        const avgTime = Math.round(this.testHistory.reduce((sum, test) => sum + test.timeTaken, 0) / totalTests / 60);

        this.elements.totalTestsTaken.textContent = totalTests;
        this.elements.avgScore.textContent = `${avgScore}%`;
        this.elements.bestScore.textContent = `${bestScore}%`;
        this.elements.avgTime.textContent = `${avgTime}m`;
    }

       handleMockGridClick(e) {
        const button = e.target.closest('[data-id]');
        if (!button) return;

        const id = button.getAttribute('data-id');
        if (button.classList.contains('btn-view')) {
            this.viewMockDetails(id);
        } else if (button.classList.contains('btn-preview')) {
            this.previewMock(id);
        } else if (button.classList.contains('btn-start')) {
            this.startMockTest(id);
        } else if (button.classList.contains('btn-delete')) {
            this.deleteMockTest(id);
        } else if (button.classList.contains('btn-history')) {
            this.viewTestHistory(id);
        }
    }

    viewMockDetails(id) {
        const mock = this.mocks.find(m => m.id === id);
        if (!mock) return;
        
        const modal = document.createElement('div');
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.right = '0';
        modal.style.bottom = '0';
        modal.style.background = 'rgba(0,0,0,0.5)';
        modal.style.display = 'flex';
        modal.style.alignItems = 'center';
        modal.style.justifyContent = 'center';
        modal.style.zIndex = '1000';
        modal.innerHTML = `
            <div style="background: #FFF; border-radius: 6px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
                <div style="padding: 12px 15px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="font-size: 15px; font-weight: 600;">${mock.name}</h3>
                    <button class="close-details-modal" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #6B7280;">×</button>
                </div>
                <div style="padding: 15px;">
                    <p><strong>Category:</strong> ${this.getCategoryInfo(mock.category).name}</p>
                    <p><strong>Duration:</strong> ${mock.duration} minutes</p>
                    <p><strong>File Name:</strong> ${mock.fileName}</p>
                    <p><strong>File Size:</strong> ${Math.round(mock.fileContent.length / 1024)} KB</p>
                    <p><strong>Description:</strong> ${mock.description || 'No description'}</p>
                    <p><strong>Created:</strong> ${new Date(mock.date).toLocaleString()}</p>
                    
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #E5E7EB;">
                        <h4>Test History</h4>
                        ${this.renderMockHistory(mock.id)}
                    </div>
                </div>
                <div style="padding: 12px 15px; border-top: 1px solid #E5E7EB; display: flex; justify-content: flex-end; gap: 8px;">
                    <button class="btn btn-primary close-details-modal" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #4F46E5; color: white;">Close</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.querySelectorAll('.close-details-modal').forEach(btn => {
            btn.addEventListener('click', () => document.body.removeChild(modal));
        });
    }

    renderMockHistory(testId) {
        const history = this.testHistory.filter(test => test.testId === testId);
        if (!history.length) return '<p>No test history available</p>';
        
        let html = '<div style="max-height: 200px; overflow-y: auto;">';
        history.forEach(test => {
            const date = new Date(test.date);
            html += `
                <div style="padding: 8px 0; border-bottom: 1px solid #E5E7EB;">
                    <div style="display: flex; justify-content: space-between;">
                        <span>${date.toLocaleString()}</span>
                        <span style="font-weight: 500;">${test.score}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 12px; color: #6B7280;">
                        <span>${test.correctAnswers}/${test.totalQuestions} correct</span>
                        <span>${Math.floor(test.timeTaken / 60)}m ${test.timeTaken % 60}s</span>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        return html;
    }

    previewMock(id) {
        const mock = this.mocks.find(m => m.id === id);
        if (!mock) return;
        
        const modal = document.createElement('div');
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.right = '0';
        modal.style.bottom = '0';
        modal.style.background = 'rgba(0,0,0,0.5)';
        modal.style.display = 'flex';
        modal.style.alignItems = 'center';
        modal.style.justifyContent = 'center';
        modal.style.zIndex = '1000';
        modal.innerHTML = `
            <div style="background: #FFF; border-radius: 6px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
                <div style="padding: 12px 15px; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                    <h3 style="font-size: 15px; font-weight: 600;">${mock.name} Preview</h3>
                    <button class="close-preview-modal" style="background: none; border: none; font-size: 18px; cursor: pointer; color: #6B7280;">×</button>
                </div>
                <div style="padding: 15px;">
                    <iframe class="preview-iframe" srcdoc="${this.escapeHtml(mock.fileContent)}" style="width: 100%; height: 350px; border: 1px solid #E5E7EB; border-radius: 5px;"></iframe>
                </div>
                <div style="padding: 12px 15px; border-top: 1px solid #E5E7EB; display: flex; justify-content: flex-end; gap: 8px;">
                    <button class="btn btn-primary close-preview-modal" style="display: inline-block; padding: 8px 15px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s; text-decoration: none; border: none; font-size: 13px; background: #4F46E5; color: white;">Close</button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.querySelectorAll('.close-preview-modal').forEach(btn => {
            btn.addEventListener('click', () => document.body.removeChild(modal));
        });
    }

    viewTestHistory(testId) {
        this.elements.categoryFilter.value = 'all';
        this.elements.searchInput.value = '';
        this.renderMocks();
        this.showHistory();
    }

    startMockTest(id) {
        const mock = this.mocks.find(m => m.id === id);
        if (!mock) return;

        // Reset iframe first
        this.elements.testIframe.srcdoc = '';
        
        // Load content after small delay
        setTimeout(() => {
            this.elements.testIframe.srcdoc = mock.fileContent;
            this.currentTest = mock;
            this.timeRemaining = mock.duration * 60;
            this.showTestInterface();
            this.startTimer();
            
            // Update test header
            this.elements.testTitle.textContent = mock.name;
            this.updateTimerDisplay();
        }, 100);
    }

    startTimer() {
        if (this.timerInterval) {
            clearInterval(this.timerInterval);
        }
        
        this.updateTimerDisplay();
        this.timerInterval = setInterval(() => {
            this.timeRemaining--;
            this.updateTimerDisplay();
            
            if (this.timeRemaining <= 0) {
                clearInterval(this.timerInterval);
                this.testCompleted();
            }
        }, 1000);
    }

    updateTimerDisplay() {
        const mins = Math.floor(this.timeRemaining / 60);
        const secs = this.timeRemaining % 60;
        this.elements.testTimer.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
        
        if (this.timeRemaining <= 300) {
            this.elements.testTimer.style.color = '#EF4444';
        } else if (this.timeRemaining <= 600) {
            this.elements.testTimer.style.color = '#F59E0B';
        } else {
            this.elements.testTimer.style.color = '#4F46E5';
        }
    }

    testCompleted() {
        if (this.timerInterval) {
            clearInterval(this.timerInterval);
            this.timerInterval = null;
        }
        
        if (this.currentTest) {
            // Calculate time taken (duration minus remaining time)
            const timeTaken = (this.currentTest.duration * 60) - this.timeRemaining;
            
            // Create test result
            const result = {
                id: Date.now().toString(),
                testId: this.currentTest.id,
                testName: this.currentTest.name,
                date: new Date().toISOString(),
                score: Math.floor(Math.random() * 30) + 70, // Random score between 70-100% for demo
                totalQuestions: 40, // Default value
                correctAnswers: Math.floor(Math.random() * 10) + 30, // Random correct answers for demo
                timeTaken: timeTaken,
                category: this.currentTest.category,
                details: {
                    quantitative: Math.floor(Math.random() * 15) + 85,
                    reasoning: Math.floor(Math.random() * 15) + 75,
                    generalAwareness: Math.floor(Math.random() * 15) + 70
                }
            };
            
            this.testHistory.unshift(result);
            this.saveTestHistory();
            this.showTestResult(result);
        }
    }

    showTestResult(result) {
        if (!result) return;
        
        // Calculate minutes and seconds from timeTaken
        const minutes = Math.floor(result.timeTaken / 60);
        const seconds = result.timeTaken % 60;
        
        // Update the result modal
        document.querySelector('#resultModal .modal-title').textContent = `${result.testName} Results`;
        document.querySelector('#resultModal .result-score').textContent = `${result.score}%`;
        document.querySelector('#resultModal .result-message').textContent = this.getResultMessage(result.score);
        
        const detailsContainer = document.querySelector('#resultModal .result-details');
        detailsContainer.innerHTML = `
            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">${result.correctAnswers}/${result.totalQuestions}</div>
                <div style="font-size: 12px; color: #6B7280;">Questions Correct</div>
            </div>
            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">${result.score}%</div>
                <div style="font-size: 12px; color: #6B7280;">Accuracy</div>
            </div>
            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">${minutes}m ${seconds}s</div>
                <div style="font-size: 12px; color: #6B7280;">Time Taken</div>
            </div>
            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">#1</div>
                <div style="font-size: 12px; color: #6B7280;">Rank</div>
            </div>
        `;
        
        // Update performance metrics
        const performanceMetrics = document.querySelector('#resultPerformanceTab .performance-metrics');
        performanceMetrics.innerHTML = `
            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">${result.score}%</div>
                <div style="font-size: 12px; color: #6B7280;">Overall Score</div>
            </div>
            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">${result.details.quantitative}%</div>
                <div style="font-size: 12px; color: #6B7280;">Quantitative</div>
            </div>
            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">${result.details.reasoning}%</div>
                <div style="font-size: 12px; color: #6B7280;">Reasoning</div>
            </div>
            <div style="background: #FFF; border-radius: 6px; padding: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">
                <div style="font-size: 18px; font-weight: 600; margin-bottom: 5px;">${result.details.generalAwareness}%</div>
                <div style="font-size: 12px; color: #6B7280;">General Awareness</div>
            </div>
        `;
        
        this.elements.resultModal.style.display = 'flex';
    }

    getResultMessage(score) {
        if (score >= 90) return "Excellent! You scored in the top 10% of test takers.";
        if (score >= 80) return "Great job! You scored better than 75% of test takers.";
        if (score >= 70) return "Good work! You scored better than 50% of test takers.";
        if (score >= 60) return "Keep practicing! You scored better than 25% of test takers.";
        return "Don't worry! Review the material and try again.";
    }

    showTestInterface() {
        this.hideAllContainers();
        this.elements.testInterface.style.display = 'block';
    }

    showDashboard() {
        this.hideAllContainers();
        this.elements.dashboardContainer.style.display = 'block';
        if (this.timerInterval) {
            clearInterval(this.timerInterval);
            this.timerInterval = null;
        }
        this.elements.testIframe.srcdoc = '';
    }

    showAnalysis() {
        this.hideAllContainers();
        this.elements.analysisContainer.style.display = 'block';
        this.renderTestAnalysis();
    }

    showHistory() {
        this.hideAllContainers();
        this.elements.historyContainer.style.display = 'block';
        this.renderTestHistory();
    }

    showSettings() {
        this.hideAllContainers();
        this.elements.settingsContainer.style.display = 'block';
    }

    hideAllContainers() {
        this.elements.dashboardContainer.style.display = 'none';
        this.elements.analysisContainer.style.display = 'none';
        this.elements.historyContainer.style.display = 'none';
        this.elements.settingsContainer.style.display = 'none';
        this.elements.testInterface.style.display = 'none';
    }

    deleteMockTest(id) {
        if (confirm('Are you sure you want to delete this mock test? All associated test history will also be deleted.')) {
            this.mocks = this.mocks.filter(mock => mock.id !== id);
            this.testHistory = this.testHistory.filter(test => test.testId !== id);
            this.saveMocks();
            this.saveTestHistory();
        }
    }

    exportMocks() {
        const dataStr = JSON.stringify(this.mocks, null, 2);
        this.downloadFile(dataStr, `mock-tests-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
    }

    exportAllData() {
        const data = {
            mocks: this.mocks,
            testHistory: this.testHistory,
            settings: {
                theme: this.elements.themeSelect.value,
                defaultDuration: this.elements.defaultDuration.value,
                autoSave: this.elements.autoSaveSelect.value
            }
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        this.downloadFile(dataStr, `mock-test-generator-data-${new Date().toISOString().split('T')[0]}.json`, 'application/json');
    }

    resetAllData() {
        this.mocks = [];
        this.testHistory = [];
        localStorage.removeItem('mockTests');
        localStorage.removeItem('testHistory');
        localStorage.removeItem('appSettings');
        this.renderMocks();
        this.renderTestHistory();
        this.renderAnalytics();
        this.renderTestAnalysis();
    }

    downloadFile(data, filename, type) {
        const blob = new Blob([data], { type });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }

    getCategoryInfo(category) {
        const categories = {
            ssc_cgl: { name: 'SSC CGL', color: '#4F46E5' },
            ssc_chsl: { name: 'SSC CHSL', color: '#10B981' },
            ssc_mts: { name: 'SSC MTS', color: '#F59E0B' },
            rrb_ntpc: { name: 'RRB NTPC', color: '#EF4444' },
            other: { name: 'Other', color: '#6B7280' }
        };
        return categories[category] || categories.other;
    }

    escapeHtml(unsafe) {
        return unsafe
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
    }
}

document.addEventListener('DOMContentLoaded', () => {
    new MockTestGenerator();
});
</script>
</body>
</html>